---
title: "Case_Study_2"
author: "Ben Tanaka"
date: "7/29/2019"
output: 
  html_document:
    keep_md: true
---

```{r setup, echo=FALSE, include=FALSE, warning=FALSE,message =FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE,message =FALSE)
library(xml2)
library(rvest)
library(stringr)
library(tibble)
library(data.table)
library(knitr)
library(kableExtra)
library(dplyr)
library(tidyr)
library(ggplot2)
library(bizdays)
library(MTS)
library(forecast)
library(smooth)
library(fpp2)
library(lubridate)
library(dygraphs)
library(xts)
library(readxl)
library(tidyverse)
library(gridExtra)
library(grid)
library(ggplot2)
library(lattice)
library(GGally)

setwd("/users/ben/documents/r/Case_Study_2")
getwd()
```

# DDSAnalytics:  Predicting Employee Turnover

```{r ETL}
df_emp_ren <- read_excel("CaseStudy2-data.xlsx")
names(df_emp_ren)

df_emp_ren$Attrition_Lvl <- factor(df_emp_ren$Attrition)
str(df_emp_ren)
summary(df_emp_ren)

```


## Employee Personal Demographics
``` {r Employee_Demographics}
EmpPerDem1 <- df_emp_ren[c("EducationField","Education","Attrition_Lvl")]
ggpairs(EmpPerDem1)

p1 <- df_emp_ren %>%
  ggplot(aes(x = EducationField, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Education Field")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = Education, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Education")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())


grid.arrange(p1, p2, nrow = 1, ncol = 2)


EmpPerDem2 <- df_emp_ren[c("NumCompaniesWorked","TotalWorkingYears", "DistanceFromHome" ,"Attrition_Lvl")]
ggpairs(EmpPerDem2)

p1 <- df_emp_ren %>%
  ggplot(aes(x = NumCompaniesWorked, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Number Companies Worked")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = TotalWorkingYears, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Total Working Years")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p3 <- df_emp_ren %>%
  ggplot(aes(x = DistanceFromHome, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Distance From Home")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

grid.arrange(p1, p2, p3, nrow = 2, ncol = 2)

EmpPerDem3 <- df_emp_ren[c("MaritalStatus","Gender","Over18","Age","Attrition_Lvl")]
ggpairs(EmpPerDem3)

p1 <- df_emp_ren %>%
  ggplot(aes(x = MaritalStatus, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Marital Status")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = Gender, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Gender")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p3 <- df_emp_ren %>%
  ggplot(aes(x = Over18, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Over 18")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p4 <- df_emp_ren %>%
  ggplot(aes(x = Age, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Age")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

grid.arrange(p1, p2, p3, p4, nrow = 2, ncol = 2)

```

### Employee Personal Demographics:  Insights
* Insights:
    1.  enter insights here
      + Hypothesis: 


## Employee Pay Rates
``` {r Employee Pay Rates}
EmpPayRte1 <- df_emp_ren[c("HourlyRate", "DailyRate", "MonthlyRate","MonthlyIncome", "PercentSalaryHike","Attrition_Lvl")]
ggpairs(EmpPayRte1)

p1 <- df_emp_ren %>%
  ggplot(aes(x = HourlyRate, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Hourly Rate")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = DailyRate, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Daily Rate")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p3 <- df_emp_ren %>%
  ggplot(aes(x = MonthlyRate, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Monthly Rate")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p4 <- df_emp_ren %>%
  ggplot(aes(x = MonthlyIncome, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Monthly Income")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p5 <- df_emp_ren %>%
  ggplot(aes(x = PercentSalaryHike, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Percent Salary Hike")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

grid.arrange(p1, p2, p3, p4, p5, nrow = 3, ncol = 3)

EmpPayRte2 <- df_emp_ren[c("StockOptionLevel","OverTime","Attrition_Lvl")]
ggpairs(EmpPayRte2)

p1 <- df_emp_ren %>%
  ggplot(aes(x = StockOptionLevel, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Stock Option Level")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = OverTime, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Over Time")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())


grid.arrange(p1, p2, nrow = 1, ncol = 2)
```

### Employee Pay Rates:  Insights
* Insights:
    1.  enter insights here
      + Hypothesis: 

## Employee Work Profile Demographics
```{r Employee Work Profile Demographics}
EmpPflDem1 <- df_emp_ren[c("YearsWithCurrManager","YearsSinceLastPromotion","YearsInCurrentRole","YearsAtCompany","PerformanceRating", "Attrition_Lvl")]
ggpairs(EmpPflDem1)

p1 <- df_emp_ren %>%
  ggplot(aes(x = YearsWithCurrManager, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years With Current Manager")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = YearsSinceLastPromotion, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years Since Last Promotion")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p3 <- df_emp_ren %>%
  ggplot(aes(x = YearsInCurrentRole, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years In Current Role")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p4 <- df_emp_ren %>%
  ggplot(aes(x = YearsAtCompany, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years At Company")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p5 <- df_emp_ren %>%
  ggplot(aes(x = PerformanceRating, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Performance Rating")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

grid.arrange(p1, p2, p3, p4, p5, nrow = 3, ncol = 3)

EmpPflDem2 <- df_emp_ren[c("WorkLifeBalance","RelationshipSatisfaction","JobSatisfaction","JobInvolvement","EnvironmentSatisfaction", "Attrition_Lvl")]
ggpairs(EmpPflDem2)

p1 <- df_emp_ren %>%
  ggplot(aes(x = WorkLifeBalance, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Work Life Balance")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = RelationshipSatisfaction, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Relationship Satisfaction")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p3 <- df_emp_ren %>%
  ggplot(aes(x = JobSatisfaction, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Job Satisfaction")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p4 <- df_emp_ren %>%
  ggplot(aes(x = JobInvolvement, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Job Involvement")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p5 <- df_emp_ren %>%
  ggplot(aes(x = EnvironmentSatisfaction, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Environment Satisfaction")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

grid.arrange(p1, p2, p3, p4, p5, nrow = 3, ncol = 3)

EmpPflDem3 <- df_emp_ren[c("TrainingTimesLastYear","StandardHours","JobRole","JobLevel","Department","BusinessTravel", "Attrition_Lvl")]
ggpairs(EmpPflDem3)

p1 <- df_emp_ren %>%
  ggplot(aes(x = TrainingTimesLastYear, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Training Times Last Year")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = StandardHours, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Standard Hours")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p3 <- df_emp_ren %>%
  ggplot(aes(x = JobRole, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Job Role")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p4 <- df_emp_ren %>%
  ggplot(aes(x = Department, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Department")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p5 <- df_emp_ren %>%
  ggplot(aes(x = BusinessTravel, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Business Travel")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

grid.arrange(p1, p2, p3, p4, p5, nrow = 3, ncol = 3)

EmpPflDem4 <- df_emp_ren[c("YearsAtCompany", "YearsInCurrentRole", "YearsSinceLastPromotion","YearsWithCurrManager", "Attrition_Lvl")]
ggpairs(EmpPflDem4)

p1 <- df_emp_ren %>%
  ggplot(aes(x = YearsAtCompany, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years At Company")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p2 <- df_emp_ren %>%
  ggplot(aes(x = YearsInCurrentRole, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years In Current Role")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p3 <- df_emp_ren %>%
  ggplot(aes(x = YearsSinceLastPromotion, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years Since Last Promotion")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

p4 <- df_emp_ren %>%
  ggplot(aes(x = YearsWithCurrManager, fill = Attrition)) + geom_density(alpha = 0.5) + ggtitle("Years With Current Manager")  + theme(plot.title = element_text(size =10),axis.text.x = element_text(size =7,angle = 45, hjust = 1),axis.title.x=element_blank())

grid.arrange(p1, p2, p3, p4,  nrow = 2, ncol = 2)

```

### Employee Work Profile Demographics:  Insights
* Insights:
    1.  enter insights here
      + Hypothesis: 
      
      
  
``` {r Regression_Analysis}



```

